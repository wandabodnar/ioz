---
title: "GIS mapping"
author: "Wanda Bodnar"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load libraries
library(leaflet)            # interactive maps
library(leaflet.extras)     # extra leaflet functions  
library(leaflet.extras2)    # extra leaflet functions
library(stars)              # for raster and spatiotemporal data
library(esri2sf)            # ArcGIS FeatureServer -> sf
library(leaflet.providers)  # leaflet basemaps
library(sf)                 # spatial data  
library(rnaturalearth)      # Natural Earth basemap

# Leaflet expects WGS84 lon/lat
target_crs <- 4326
```


## My first online map

```{r, echo=TRUE}
# Earthquakes
eq <- st_read("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_day.geojson")

# Fault lines
faults <- esri2sf::esri2sf(
  "https://services.arcgis.com/jIL9msH9OI208GCb/ArcGIS/rest/services/Active_Faults/FeatureServer/0",
  where = "1=1") %>%
  st_transform(target_crs)

# Map
leaflet() %>%
  setView(lng = 63, lat = 28, zoom = 2) %>%
  addProviderTiles(providers$CartoDB.DarkMatter, group = "Carto") %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Satellite") %>%
  addPolylines(
    data = faults,
    color = "orange",
    weight = 2,
    popup = ~paste("Name:", name),
    group = "Faults") %>%
  addCircleMarkers(
    data = eq,
    color = "red",
    fillOpacity = 1,
    radius = ~mag,
    popup = ~paste("Location:", place, "<br>",
                   "Magnitude:", mag, "<br>",
                   "Date:", as.character(as.POSIXct(time/1000, origin="1970-01-01"))),
    group = "Earthquakes") %>%
  addLayersControl(
    baseGroups = c("Carto","Satellite"),
    overlayGroups = c("Earthquakes", "Faults"),
    options = layersControlOptions(collapsed = FALSE)) %>%
  addLegend(
    position = "bottomright",
    colors = c("red", "orange"),
    labels = c("Circle size proportional to magnitude", "Fault lines"),
    opacity = 1) %>%
  addResetMapButton() %>%
  addFullscreenControl()
```
